{% extends "base.html" %}

{% block title %}–ê–≤—Ç–æ–ø–æ–¥–Ω—è—Ç–∏–µ —Å–µ—Ä–≤–µ—Ä–∞{% endblock %}

{% block content %}
<div class="auto-deploy-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="deploy-header">
        <div class="header-content">
            <h1 class="deploy-title">
                <span class="rocket-icon">üöÄ</span>
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
            </h1>
            <p class="deploy-subtitle">–ë—ã—Å—Ç—Ä–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ VPN-—Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –ø–∞–Ω–µ–ª—å—é 3x-ui</p>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ -->
    <div class="stats-overview">
        <div class="stats-grid">
            <div class="stat-card servers">
                <div class="stat-icon">üñ•Ô∏è</div>
                <div class="stat-content">
                    <h3>{{ total_capacity.hosts_count }}</h3>
                    <p>–í—Å–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–æ–≤</p>
                </div>
            </div>
            <div class="stat-card configs">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-content">
                    <h3>{{ total_capacity.total_configs }}</h3>
                    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</p>
                </div>
            </div>
            <div class="stat-card capacity">
                <div class="stat-icon">üíæ</div>
                <div class="stat-content">
                    <h3>{{ total_capacity.total_capacity }}</h3>
                    <p>–û–±—â–∞—è –µ–º–∫–æ—Å—Ç—å</p>
                </div>
            </div>
            <div class="stat-card load">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <h3>{{ total_capacity.load_percentage }}%</h3>
                    <p>–û–±—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –§–æ—Ä–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è -->
        <div class="deploy-form-container">
            <div class="deploy-card">
                <div class="card-header">
                    <h2>üÜï –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä</h2>
                    <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPN-—Å–µ—Ä–≤–µ—Ä–∞</p>
                </div>
                
                <div class="card-body">
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                    <div id="deploy-progress" class="deploy-progress hidden">
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="progress-text">–ò–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...</div>
                        </div>
                        <div class="progress-steps">
                            <div class="step" data-step="1">SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</div>
                            <div class="step" data-step="2">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ 3x-ui</div>
                            <div class="step" data-step="3">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–Ω–µ–ª–∏</div>
                            <div class="step" data-step="4">–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>
                    
                    <form id="deploy-form" method="post">
                        <input type="hidden" name="action" value="deploy">
                        
                        <div class="form-group">
                            <label for="host_name" class="form-label">
                                <span class="label-icon">üè∑Ô∏è</span>
                                –ò–º—è —Ö–æ—Å—Ç–∞*
                            </label>
                            <input type="text" class="form-input" id="host_name" name="host_name" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Server-Moscow-1" required>
                            <div class="form-hint">–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞</div>
                        </div>

                        <div class="form-group">
                            <label for="ssh_host" class="form-label">
                                <span class="label-icon">üåê</span>
                                IP –∞–¥—Ä–µ—Å / –î–æ–º–µ–Ω*
                            </label>
                            <input type="text" class="form-input" id="ssh_host" name="ssh_host" 
                                   placeholder="123.456.789.0 –∏–ª–∏ server.example.com" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="ssh_username" class="form-label">
                                    <span class="label-icon">üë§</span>
                                    SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å*
                                </label>
                                <input type="text" class="form-input" id="ssh_username" name="ssh_username" 
                                       placeholder="root" value="root" required>
                            </div>
                            <div class="form-group">
                                <label for="ssh_port" class="form-label">
                                    <span class="label-icon">üîå</span>
                                    SSH –ø–æ—Ä—Ç
                                </label>
                                <input type="number" class="form-input" id="ssh_port" name="ssh_port" 
                                       value="22" min="1" max="65535">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ssh_password" class="form-label">
                                <span class="label-icon">üîë</span>
                                SSH –ø–∞—Ä–æ–ª—å*
                            </label>
                            <div class="password-input">
                                <input type="password" class="form-input" id="ssh_password" name="ssh_password" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è SSH" required>
                                <button type="button" class="password-toggle" onclick="togglePassword('ssh_password')">
                                    üëÅÔ∏è
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="max_configs" class="form-label">
                                <span class="label-icon">üìä</span>
                                –ú–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
                            </label>
                            <input type="number" class="form-input" id="max_configs" name="max_configs" 
                                   value="20" min="1" max="1000">
                            <div class="form-hint">–õ–∏–º–∏—Ç VPN-–∫–ª—é—á–µ–π –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞</div>
                        </div>

                        <button type="submit" class="deploy-button" id="deploy-btn">
                            <span class="btn-icon">üöÄ</span>
                            <span class="btn-text">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä</span>
                            <div class="btn-loader hidden">
                                <div class="loader"></div>
                            </div>
                        </button>
                    </form>

                    <div class="deploy-info">
                        <div class="info-card">
                            <span class="info-icon">‚è±Ô∏è</span>
                            <span>–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: 3-5 –º–∏–Ω—É—Ç</span>
                        </div>
                        <div class="info-card">
                            <span class="info-icon">üõ°Ô∏è</span>
                            <span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Reality</span>
                        </div>
                        <div class="info-card">
                            <span class="info-icon">‚ö°</span>
                            <span>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏ -->
        <div class="server-management">
            <div class="management-card">
                <div class="card-header">
                    <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏</h2>
                    <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
                
                <div class="card-body">
                    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                    <div class="global-settings">
                        <h3>üåê –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                        <form method="post" class="settings-form">
                            <input type="hidden" name="action" value="update_limits">
                            
                            <div class="form-group">
                                <label for="global_limit" class="form-label">
                                    <span class="label-icon">üìä</span>
                                    –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
                                </label>
                                <input type="number" class="form-input" id="global_limit" name="global_limit" 
                                       placeholder="20" min="1" max="1000">
                                <div class="form-hint">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç –∫–æ –≤—Å–µ–º —Å–µ—Ä–≤–µ—Ä–∞–º</div>
                            </div>

                            <button type="submit" class="action-button success">
                                <span class="btn-icon">‚úÖ</span>
                                <span>–û–±–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã</span>
                            </button>
                        </form>
                    </div>

                    <!-- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ -->
                    {% if load_stats %}
                    <div class="individual-settings">
                        <h3>üñ•Ô∏è –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                        <form method="post" class="servers-form">
                            <input type="hidden" name="action" value="update_limits">
                            
                            <div class="servers-list">
                                {% for host in load_stats %}
                                <div class="server-item">
                                    <div class="server-info">
                                        <div class="server-name">{{ host.host_name }}</div>
                                        <div class="server-stats">
                                            {{ host.current_configs }}/{{ host.max_configs }} 
                                            ({{ "%.1f"|format(host.load_percentage) }}%)
                                        </div>
                                    </div>
                                    <div class="server-control">
                                        <input type="number" class="server-limit-input" 
                                               name="limit_{{ host.host_name }}" 
                                               value="{{ host.max_configs }}" 
                                               min="1" max="1000">
                                        <div class="load-indicator">
                                            <div class="load-bar">
                                                {% set load_class = "low" if host.load_percentage < 50 else "medium" if host.load_percentage < 80 else "high" %}
                                                <div class="load-fill {{ load_class }}" 
                                                     style="width: {{ host.load_percentage }}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <button type="submit" class="action-button success">
                                <span class="btn-icon">üîß</span>
                                <span>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                            </button>
                        </form>
                    </div>
                    {% endif %}

                    <!-- –î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã -->
                    <div class="system-actions">
                        <h3>üîÑ –°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="actions-grid">
                            <form method="post" class="action-form">
                                <input type="hidden" name="action" value="sync_counters">
                                <button type="submit" class="action-button warning">
                                    <span class="btn-icon">üîÑ</span>
                                    <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫–∏</span>
                                </button>
                                <div class="action-hint">–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö</div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ -->
    {% if load_stats %}
    <div class="servers-stats">
        <div class="stats-card">
            <div class="card-header">
                <h2>üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤</h2>
                <p>–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤</p>
            </div>
            
            <div class="card-body">
                <div class="servers-table">
                    <div class="table-header">
                        <div class="col-server">–°–µ—Ä–≤–µ—Ä</div>
                        <div class="col-usage">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</div>
                        <div class="col-limit">–õ–∏–º–∏—Ç</div>
                        <div class="col-load">–ó–∞–≥—Ä—É–∑–∫–∞</div>
                        <div class="col-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                        <div class="col-status">–°—Ç–∞—Ç—É—Å</div>
                    </div>
                    
                    <div class="table-body">
                        {% for host in load_stats %}
                        <div class="table-row">
                            <div class="col-server">
                                <div class="server-name">{{ host.host_name }}</div>
                            </div>
                            <div class="col-usage">
                                <span class="usage-count">{{ host.current_configs }}</span>
                            </div>
                            <div class="col-limit">
                                <span class="limit-count">{{ host.max_configs }}</span>
                            </div>
                            <div class="col-load">
                                <span class="load-percentage">{{ "%.1f"|format(host.load_percentage) }}%</span>
                            </div>
                            <div class="col-progress">
                                <div class="progress-container">
                                    {% set load_class = "low" if host.load_percentage < 50 else "medium" if host.load_percentage < 80 else "high" %}
                                    <div class="progress-bar {{ load_class }}">
                                        <div class="progress-fill" style="width: {{ host.load_percentage }}%"></div>
                                        <span class="progress-text">{{ host.current_configs }}/{{ host.max_configs }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-status">
                                {% if host.load_percentage < 50 %}
                                    <span class="status-badge free">üü¢ –°–≤–æ–±–æ–¥–µ–Ω</span>
                                {% elif host.load_percentage < 80 %}
                                    <span class="status-badge filling">üü° –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è</span>
                                {% elif host.load_percentage < 100 %}
                                    <span class="status-badge almost-full">üü† –ü–æ—á—Ç–∏ –ø–æ–ª–æ–Ω</span>
                                {% else %}
                                    <span class="status-badge full">üî¥ –ó–∞–ø–æ–ª–Ω–µ–Ω</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –ø–∞–Ω–µ–ª–µ–π -->
    {% if auto_deploy_data %}
    <div class="deployed-panels">
        <div class="panels-card">
            <div class="card-header">
                <h2>üóÇÔ∏è –†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –ø–∞–Ω–µ–ª–∏</h2>
                <p>–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∞–Ω–µ–ª–µ–π, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π</p>
            </div>
            
            <div class="card-body">
                <div class="panels-table">
                    <div class="table-header">
                        <div class="col-name">–ò–º—è</div>
                        <div class="col-host">–•–æ—Å—Ç</div>
                        <div class="col-panel">–ü–∞–Ω–µ–ª—å</div>
                        <div class="col-credentials">–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–∞</div>
                        <div class="col-status">–°—Ç–∞—Ç—É—Å</div>
                        <div class="col-created">–°–æ–∑–¥–∞–Ω</div>
                    </div>
                    
                    <div class="table-body">
                        {% for panel in auto_deploy_data %}
                        <div class="table-row">
                            <div class="col-name">
                                <div class="panel-name">{{ panel.name }}</div>
                            </div>
                            <div class="col-host">
                                <div class="host-info">
                                    <div class="host-ip">{{ panel.ssh_host }}</div>
                                    <div class="ssh-port">SSH: {{ panel.new_ssh_port if panel.new_ssh_port else panel.ssh_port }}</div>
                                </div>
                            </div>
                            <div class="col-panel">
                                {% if panel.panel_url %}
                                    <a href="{{ panel.panel_url }}" target="_blank" class="panel-link">
                                        {{ panel.ssh_host }}:{{ panel.panel_port }}{{ panel.panel_secpath }}
                                    </a>
                                {% else %}
                                    <div class="panel-info">
                                        <div class="panel-port">–ü–æ—Ä—Ç: {{ panel.panel_port }}</div>
                                        <div class="panel-secpath">–ü—É—Ç—å: {{ panel.panel_secpath }}</div>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-credentials">
                                <div class="credentials-info">
                                    <div class="username">
                                        üë§ {{ panel.panel_username }}
                                        <button class="copy-btn" onclick="copyToClipboard('{{ panel.panel_username }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω">üìã</button>
                                    </div>
                                    <div class="password">
                                        üîë {{ panel.panel_password }}
                                        <button class="copy-btn" onclick="copyToClipboard('{{ panel.panel_password }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å">üìã</button>
                                    </div>
                                    {% if panel.new_ssh_port %}
                                    <div class="ssh-port">
                                        üîå SSH Port: {{ panel.new_ssh_port }}
                                        <button class="copy-btn" onclick="copyToClipboard('{{ panel.new_ssh_port }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å SSH –ø–æ—Ä—Ç">üìã</button>
                                    </div>
                                    {% endif %}
                                    {% if panel.new_ssh_password %}
                                    <div class="ssh-password">
                                        üîê SSH Password: {{ panel.new_ssh_password }}
                                        <button class="copy-btn" onclick="copyToClipboard('{{ panel.new_ssh_password }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å SSH –ø–∞—Ä–æ–ª—å">üìã</button>
                                    </div>
                                    {% endif %}
                                    {% if panel.ssh_public_key %}
                                    <div class="ssh-key">
                                        üîê SSH Key: 
                                        <span class="ssh-key-text" title="{{ panel.ssh_public_key }}" onclick="copyToClipboard('{{ panel.ssh_public_key }}')">{{ panel.ssh_public_key }}</span>
                                        <button class="copy-btn" onclick="copyToClipboard('{{ panel.ssh_public_key }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å SSH –∫–ª—é—á">üìã</button>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-status">
                                {% if panel.status == 'completed' %}
                                    <span class="status-badge success">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</span>
                                {% elif panel.status == 'deploying' %}
                                    <span class="status-badge deploying">üîÑ –î–µ–ø–ª–æ–π</span>
                                {% elif panel.status == 'error' %}
                                    <span class="status-badge error">‚ùå –û—à–∏–±–∫–∞</span>
                                {% else %}
                                    <span class="status-badge unknown">‚ùì {{ panel.status }}</span>
                                {% endif %}
                            </div>
                            <div class="col-created">
                                <div class="created-date">{{ panel.created_at }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã auto-deploy */
.auto-deploy-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
.deploy-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 40px 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.deploy-title {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin: 0 0 15px 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.rocket-icon {
    display: inline-block;
    margin-right: 15px;
    font-size: 3.5rem;
    animation: rocket-bounce 2s infinite;
}

@keyframes rocket-bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.deploy-subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-weight: 400;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-overview {
    margin-bottom: 40px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 25px;
    display: flex;
    align-items: center;
    gap: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.stat-icon {
    font-size: 2.5rem;
    min-width: 60px;
    text-align: center;
}

.stat-content h3 {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    color: #2c3e50;
}

.stat-content p {
    margin: 5px 0 0 0;
    color: #7f8c8d;
    font-weight: 500;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
}

@media (max-width: 1024px) {
    .main-content {
        grid-template-columns: 1fr;
    }
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.deploy-card, .management-card, .stats-card, .panels-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 30px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.card-header h2 {
    font-size: 1.8rem;
    font-weight: 600;
    margin: 0 0 10px 0;
    color: #2c3e50;
}

.card-header p {
    margin: 0;
    color: #6c757d;
    font-size: 1rem;
}

.card-body {
    padding: 30px;
}

/* –§–æ—Ä–º—ã */
.form-group {
    margin-bottom: 25px;
}

.form-row {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
}

.form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    font-size: 1rem;
}

.label-icon {
    font-size: 1.2rem;
}

.form-input {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #fff;
}

.form-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.password-input {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: background 0.2s ease;
}

.password-toggle:hover {
    background: rgba(0, 0, 0, 0.05);
}

.form-hint {
    margin-top: 5px;
    font-size: 0.9rem;
    color: #6c757d;
}

/* –ö–Ω–æ–ø–∫–∏ */
.deploy-button, .action-button {
    position: relative;
    width: 100%;
    padding: 18px 25px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.deploy-button:hover, .action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.action-button.success {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.action-button.warning {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
}

.btn-icon {
    font-size: 1.2rem;
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–µ–ø–ª–æ—è */
.deploy-progress {
    margin-bottom: 30px;
    padding: 25px;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    border-radius: 15px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.progress-container {
    margin-bottom: 20px;
}

.progress-bar {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.5s ease;
    animation: progress-pulse 2s infinite;
}

@keyframes progress-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.progress-text {
    text-align: center;
    font-weight: 600;
    color: #2c3e50;
}

.progress-steps {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.step {
    padding: 10px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 8px;
    text-align: center;
    font-size: 0.9rem;
    font-weight: 500;
    color: #6c757d;
    transition: all 0.3s ease;
}

.step.active {
    background: #667eea;
    color: white;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.deploy-info {
    margin-top: 30px;
    display: grid;
    gap: 15px;
}

.info-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.info-icon {
    font-size: 1.3rem;
}

/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ */
.global-settings, .individual-settings, .system-actions {
    margin-bottom: 30px;
}

.global-settings h3, .individual-settings h3, .system-actions h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.3rem;
    font-weight: 600;
}

.servers-list {
    margin-bottom: 25px;
}

.server-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    background: rgba(248, 249, 250, 0.8);
    border-radius: 12px;
    margin-bottom: 15px;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.server-info {
    flex: 1;
}

.server-name {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
}

.server-stats {
    font-size: 0.9rem;
    color: #6c757d;
}

.server-control {
    display: flex;
    align-items: center;
    gap: 15px;
}

.server-limit-input {
    width: 80px;
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    text-align: center;
}

.load-indicator {
    width: 100px;
}

.load-bar {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.load-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.load-fill.low {
    background: linear-gradient(90deg, #28a745, #20c997);
}

.load-fill.medium {
    background: linear-gradient(90deg, #ffc107, #fd7e14);
}

.load-fill.high {
    background: linear-gradient(90deg, #dc3545, #e74c3c);
}

.action-hint {
    margin-top: 8px;
    font-size: 0.85rem;
    color: #6c757d;
    text-align: center;
}

/* –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.servers-table {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.table-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 2fr 1.5fr;
    gap: 20px;
    padding: 20px;
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 2px solid #dee2e6;
}

.table-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 2fr 1.5fr;
    gap: 20px;
    padding: 20px;
    border-bottom: 1px solid #f8f9fa;
    align-items: center;
    transition: background 0.2s ease;
}

.table-row:hover {
    background: rgba(102, 126, 234, 0.02);
}

.table-row:last-child {
    border-bottom: none;
}

.progress-container {
    position: relative;
}

.progress-bar {
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.8rem;
    font-weight: 600;
    color: #2c3e50;
    z-index: 2;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
}

.status-badge.free {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.status-badge.filling {
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.status-badge.almost-full {
    background: rgba(253, 126, 20, 0.1);
    color: #fd7e14;
}

.status-badge.full {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

/* –£—Ç–∏–ª–∏—Ç—ã */
.hidden {
    display: none !important;
}

/* Loader */
.loader {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 2px solid white;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .deploy-title {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .table-header, .table-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .server-item {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    .server-control {
        justify-content: space-between;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –ø–∞–Ω–µ–ª–µ–π */
.deployed-panels {
    margin-top: 40px;
}

.panels-table {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.panels-table .table-header {
    display: grid;
    grid-template-columns: 1.5fr 1.5fr 1.5fr 2fr 1fr 1.2fr;
    gap: 15px;
    padding: 20px;
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 2px solid #dee2e6;
}

.panels-table .table-row {
    display: grid;
    grid-template-columns: 1.5fr 1.5fr 1.5fr 2fr 1fr 1.2fr;
    gap: 15px;
    padding: 20px;
    border-bottom: 1px solid #f8f9fa;
    align-items: center;
    transition: background 0.2s ease;
}

.panels-table .table-row:hover {
    background: rgba(102, 126, 234, 0.02);
}

.panels-table .table-row:last-child {
    border-bottom: none;
}

.panel-name {
    font-weight: 600;
    color: #2c3e50;
}

.host-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.host-ip {
    font-weight: 500;
    color: #2c3e50;
}

.ssh-port {
    font-size: 0.85rem;
    color: #6c757d;
}

.panel-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
}

.panel-link:hover {
    color: #764ba2;
    text-decoration: underline;
}

.panel-port {
    color: #6c757d;
    font-size: 0.9rem;
}

.panel-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.panel-secpath {
    color: #495057;
    font-size: 0.85rem;
    font-family: monospace;
    background: rgba(248, 249, 250, 0.8);
    padding: 2px 6px;
    border-radius: 3px;
    border: 1px solid #e9ecef;
}

.credentials-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
    font-family: monospace;
    font-size: 0.85rem;
}

.username, .password, .ssh-key {
    padding: 4px 8px;
    background: rgba(248, 249, 250, 0.8);
    border-radius: 4px;
    border: 1px solid #e9ecef;
}

.ssh-key-text {
    font-family: monospace;
    font-size: 0.8rem;
    color: #495057;
    cursor: pointer;
    background: #f5f5f5;
    padding: 2px 4px;
    border-radius: 3px;
    border: 1px solid #ddd;
    word-break: break-all;
}

.ssh-key-text:hover {
    background: #e9e9e9;
}

.copy-btn {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 3px;
    padding: 2px 6px;
    font-size: 0.7rem;
    cursor: pointer;
    margin-left: 5px;
}

.copy-btn:hover {
    background: #0056b3;
}

.status-badge.success {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.status-badge.deploying {
    background: rgba(0, 123, 255, 0.1);
    color: #007bff;
}

.status-badge.error {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

.status-badge.unknown {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
}

.created-date {
    font-size: 0.85rem;
    color: #6c757d;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–∞–Ω–µ–ª–µ–π */
@media (max-width: 1200px) {
    .panels-table .table-header,
    .panels-table .table-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .panels-table .table-header {
        display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    }
    
    .panels-table .table-row {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 10px;
        padding: 15px;
    }
    
    .panels-table .table-row > div {
        margin-bottom: 8px;
    }
    
    .panels-table .table-row > div:before {
        content: attr(data-label);
        font-weight: 600;
        color: #6c757d;
        display: block;
        margin-bottom: 4px;
        font-size: 0.8rem;
        text-transform: uppercase;
    }
}
</style>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const button = input.nextElementSibling;
    
    if (input.type === 'password') {
        input.type = 'text';
        button.textContent = 'üôà';
    } else {
        input.type = 'password';
        button.textContent = 'üëÅÔ∏è';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.createElement('div');
        notification.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 14px;
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 2000);
    }).catch(function(err) {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    });
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–ø–ª–æ—è
let deploySessionId = null;
let deployStatusInterval = null;

// –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
let isDeployInProgress = false;

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
document.getElementById('deploy-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–µ–ø–ª–æ–π –Ω–µ –∏–¥–µ—Ç —É–∂–µ
    if (isDeployInProgress) {
        showNotification('–î–µ–ø–ª–æ–π —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.', 'error');
        return;
    }
    
    const deployBtn = document.getElementById('deploy-btn');
    const deployProgress = document.getElementById('deploy-progress');
    const formData = new FormData(this);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
    isDeployInProgress = true;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    deployProgress.classList.remove('hidden');
    deployBtn.disabled = true;
    deployBtn.querySelector('.btn-text').textContent = '–ó–∞–ø—É—Å–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è...';
    deployBtn.querySelector('.btn-loader').classList.remove('hidden');
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/auto-deploy', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams(formData)
    })
    .then(response => response.text())
    .then(data => {
        // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å session_id –∏–∑ flash —Å–æ–æ–±—â–µ–Ω–∏–π
        if (data.includes('—Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ')) {
            // –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å
            startMockDeployTracking();
        } else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            document.body.innerHTML = data;
            return;
        }
    })
    .catch(error => {
        console.error('Deploy error:', error);
        isDeployInProgress = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        showDeployError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞: ' + error.message);
    });
});

function startMockDeployTracking() {
    // –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –ø–æ–ª—É—á–∞–µ–º session_id –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –æ—Ç–≤–µ—Ç–µ,
    // —Å–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —ç—Ç–∞–ø–∞–º–∏
    const steps = document.querySelectorAll('.step');
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    
    let currentStep = 0;
    let progress = 0;
    
    const stepTexts = [
        '–ü—Ä–æ–≤–µ—Ä–∫–∞ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...',
        '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ 3x-ui –ø–∞–Ω–µ–ª–∏...',
        '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...',
        '–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏...'
    ];
    
    const deployInterval = setInterval(() => {
        if (currentStep < 4) {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            steps[currentStep].classList.add('active');
            progressText.textContent = stepTexts[currentStep];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progress = (currentStep + 1) * 25;
            progressFill.style.width = progress + '%';
            
            currentStep++;
        } else {
            // –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
            clearInterval(deployInterval);
            setTimeout(() => {
                showDeploySuccess();
            }, 2000);
        }
    }, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–æ–≤—ã–π —ç—Ç–∞–ø
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π –æ—Ç–º–µ–Ω—ã
    deployStatusInterval = deployInterval;
}

function showDeploySuccess() {
    const deployProgress = document.getElementById('deploy-progress');
    const deployBtn = document.getElementById('deploy-btn');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–µ–ø–ª–æ—è
    isDeployInProgress = false;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    const progressText = document.querySelector('.progress-text');
    progressText.textContent = '–î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!';
    progressText.style.color = '#28a745';
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    deployBtn.disabled = false;
    deployBtn.querySelector('.btn-text').textContent = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä';
    deployBtn.querySelector('.btn-loader').classList.add('hidden');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
    showNotification('–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.', 'success');
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        window.location.reload();
    }, 5000);
}

function showDeployError(message) {
    const deployProgress = document.getElementById('deploy-progress');
    const deployBtn = document.getElementById('deploy-btn');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–µ–ø–ª–æ—è
    isDeployInProgress = false;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    const progressText = document.querySelector('.progress-text');
    progressText.textContent = '–û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è: ' + message;
    progressText.style.color = '#dc3545';
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    deployBtn.disabled = false;
    deployBtn.querySelector('.btn-text').textContent = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä';
    deployBtn.querySelector('.btn-loader').classList.add('hidden');
    
    showNotification(message, 'error');
}

function showNotification(message, type) {
    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">${type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ùå'}</span>
            <span class="notification-text">${message}</span>
            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if (!document.querySelector('#notification-styles')) {
        const styles = document.createElement('style');
        styles.id = 'notification-styles';
        styles.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            }
            .notification.success {
                border-left: 4px solid #28a745;
            }
            .notification.error {
                border-left: 4px solid #dc3545;
            }
            .notification.warning {
                border-left: 4px solid #ffc107;
            }
            .notification-content {
                display: flex;
                align-items: center;
                padding: 15px 20px;
                gap: 10px;
            }
            .notification-icon {
                font-size: 1.2rem;
            }
            .notification-text {
                flex: 1;
                color: #2c3e50;
            }
            .notification-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #6c757d;
                padding: 0;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(styles);
    }
    
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 10000);
}

// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.stat-card, .deploy-card, .management-card');
    
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    checkPageReloadProtection();
});

function checkPageReloadProtection() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è
    const savedDeployState = localStorage.getItem('deployInProgress');
    const savedDeployTimestamp = localStorage.getItem('deployTimestamp');
    
    if (savedDeployState === 'true' && savedDeployTimestamp) {
        const deployTime = parseInt(savedDeployTimestamp);
        const currentTime = Date.now();
        const timeDiff = currentTime - deployTime;
        
        // –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –±—ã–ª –∑–∞–ø—É—â–µ–Ω –º–µ–Ω–µ–µ 10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
        if (timeDiff < 10 * 60 * 1000) { // 10 –º–∏–Ω—É—Ç
            showNotification('–í–Ω–∏–º–∞–Ω–∏–µ: –¥–µ–ø–ª–æ–π –º–æ–∂–µ—Ç –≤—Å–µ –µ—â–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ–≥–æ.', 'warning');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
            const deployBtn = document.getElementById('deploy-btn');
            deployBtn.disabled = true;
            deployBtn.querySelector('.btn-text').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è...)';
            
            setTimeout(() => {
                deployBtn.disabled = false;
                deployBtn.querySelector('.btn-text').textContent = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä';
                localStorage.removeItem('deployInProgress');
                localStorage.removeItem('deployTimestamp');
            }, 30000);
        } else {
            // –°—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ—á–∏—â–∞–µ–º
            localStorage.removeItem('deployInProgress');
            localStorage.removeItem('deployTimestamp');
        }
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–ø–ª–æ—è
function startMockDeployTracking() {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage
    localStorage.setItem('deployInProgress', 'true');
    localStorage.setItem('deployTimestamp', Date.now().toString());
    
    // –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –ø–æ–ª—É—á–∞–µ–º session_id –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –æ—Ç–≤–µ—Ç–µ,
    // —Å–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —ç—Ç–∞–ø–∞–º–∏
    const steps = document.querySelectorAll('.step');
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    
    let currentStep = 0;
    let progress = 0;
    
    const stepTexts = [
        '–ü—Ä–æ–≤–µ—Ä–∫–∞ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...',
        '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ 3x-ui –ø–∞–Ω–µ–ª–∏...',
        '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...',
        '–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏...'
    ];
    
    const deployInterval = setInterval(() => {
        if (currentStep < 4) {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            steps[currentStep].classList.add('active');
            progressText.textContent = stepTexts[currentStep];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progress = (currentStep + 1) * 25;
            progressFill.style.width = progress + '%';
            
            currentStep++;
        } else {
            // –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
            clearInterval(deployInterval);
            localStorage.removeItem('deployInProgress');
            localStorage.removeItem('deployTimestamp');
            setTimeout(() => {
                showDeploySuccess();
            }, 2000);
        }
    }, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–æ–≤—ã–π —ç—Ç–∞–ø
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π –æ—Ç–º–µ–Ω—ã
    deployStatusInterval = deployInterval;
}
</script>
{% endblock %}
